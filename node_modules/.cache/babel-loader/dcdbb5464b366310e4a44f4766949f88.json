{"ast":null,"code":"var _jsxFileName = \"/Users/guokai/Desktop/React-connect/src/Prism/Okadia/index22.jsx\";\n\n/**\n * Created by zhanglei on 2017/5/23.\n */\nimport React, { Component } from \"react\";\nimport { Modal, message } from \"antd\";\nimport PropTypes from \"prop-types\"; // import \"./edit.less\";\n\nimport ToolBar from \"./toolBar\";\nexport default class Editor extends Component {\n  constructor(props) {\n    super(props);\n\n    this.moveToEnd = () => {\n      const range = window.getSelection();\n      range.selectAllChildren(this.refs[\"inputText\"]);\n      range.collapseToEnd();\n    };\n\n    this.documentClick = e => {\n      const _this$state = this.state,\n            isColor = _this$state.isColor,\n            isBackground = _this$state.isBackground;\n\n      if (isColor || isBackground) {\n        let en = e.srcElement || e.target;\n        const name = \".color-content\";\n\n        while (en) {\n          if (en.className && en.className === name.replace(\".\", \"\")) {\n            return;\n          }\n\n          en = en.parentNode;\n        }\n\n        this.setState({\n          isColor: false,\n          isBackground: false\n        });\n      }\n    };\n\n    this.onPaste = e => {\n      let cbd = e.clipboardData;\n\n      if (!(e.clipboardData && e.clipboardData.items)) {\n        return;\n      }\n\n      this.onParseOrDrop(cbd, e);\n    };\n\n    this.onDrop = e => {\n      e.preventDefault();\n      let cbd = e.dataTransfer;\n\n      if (!(e.dataTransfer && e.dataTransfer.items)) {\n        return;\n      }\n\n      this.onParseOrDrop(cbd, e);\n    };\n\n    this.onParseOrDrop = (cbd, e) => {\n      let ua = window.navigator.userAgent;\n\n      if (cbd.items && cbd.items.length === 2 && cbd.items[0].kind === \"string\" && cbd.items[1].kind === \"file\" && cbd.types && cbd.types.length === 2 && cbd.types[0] === \"text/plain\" && cbd.types[1] === \"Files\" && ua.match(/Macintosh/i) && Number(ua.match(/Chrome\\/(\\d{2})/i)[1]) < 49) {\n        return;\n      }\n\n      if (cbd.items && cbd.items.length === 4) {\n        document.createElement(\"table\");\n        return false;\n      }\n\n      const myArray = Object.keys(cbd.items).map(item => {\n        return cbd.items[item];\n      });\n      const arr = myArray.some(u => {\n        if (u.kind === \"file\" && u.type !== \"image/jpeg\" && u.type !== \"image/png\") {\n          message.error(\"仅支持PNG或者JPG的图片格式上传\");\n          return !1;\n        }\n\n        return u.kind === \"file\" && (u.type === \"image/jpeg\" || u.type === \"image/png\");\n      });\n      if (!arr) return !1;\n      myArray.forEach(item => {\n        if (item.kind === \"string\") {\n          e.preventDefault();\n          return;\n        }\n\n        if (item.kind === \"file\") {\n          e.preventDefault();\n          const blob = item.getAsFile();\n          if (blob.size === 0) return;\n          this.bind_parse(blob);\n        }\n      });\n    };\n\n    this.bind_parse = file => {\n      const reader = new FileReader();\n\n      reader.onload = e => {\n        const newImg = `<img class=\"edit-img\" title='点击放大' src=\"${e.target.result}\"/>`;\n        const onChange = this.props.onChange;\n\n        if (onChange) {\n          onChange(this.inputText.innerHTML + newImg);\n        }\n      };\n\n      reader.readAsDataURL(file);\n    };\n\n    this.textHtml = e => {\n      e.preventDefault();\n      const isEdit = this.state.isEdit;\n      let html = null;\n\n      if (isEdit) {\n        html = this.refs[\"inputText\"].innerHTML;\n        this.refs[\"inputText2\"].value = html;\n        this.setState({\n          isEdit: false,\n          myDisabled: true\n        });\n      } else {\n        html = this.refs[\"inputText2\"].value;\n        this.refs[\"inputText\"].innerHTML = html;\n        this.setState({\n          isEdit: true,\n          myDisabled: false\n        });\n      }\n    };\n\n    this.emitChange = e => {\n      const onChange = this.props.onChange;\n      const html = e.target.innerHTML;\n\n      if (onChange && html !== this.lastHtml) {\n        onChange(html);\n      }\n\n      this.lastHtml = html;\n    };\n\n    this.state = {\n      value: null,\n      tableData: [],\n      linkModel: false,\n      visible: false,\n      isColor: false,\n      editValue: \"\",\n      myDisabled: false,\n      isEdit: true,\n      isFace: false,\n      isBackground: false,\n      linkValue: null,\n      isSent: true\n    };\n  }\n\n  componentDidMount() {\n    document.addEventListener(\"click\", this.documentClick);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener(\"click\", this.documentClick);\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    return nextProps.value !== this.props.value || this.state.editValue !== nextState.editValue || this.state.visible !== nextState.visible || this.state.myDisabled !== nextState.myDisabled;\n  }\n\n  render() {\n    const _this$state2 = this.state,\n          isEdit = _this$state2.isEdit,\n          visible = _this$state2.visible,\n          myDisabled = _this$state2.myDisabled;\n    const _this$props = this.props,\n          disabled = _this$props.disabled,\n          editColor = _this$props.editColor;\n    const isDisabled = !(\"disabled\" in this.props) || !disabled;\n    return React.createElement(\"div\", {\n      className: \"editor-full\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168\n      },\n      __self: this\n    }, isDisabled && React.createElement(ToolBar, {\n      id: this.props.id,\n      myDisabled: myDisabled,\n      bind_parse: this.bind_parse,\n      textHtml: this.textHtml,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"inputText\",\n      style: {\n        borderColor: editColor\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"input-content-edit\",\n      onPaste: this.onPaste,\n      onDrop: this.onDrop,\n      onInput: this.emitChange,\n      contentEditable: isDisabled,\n      onBlur: this.emitChange,\n      dangerouslySetInnerHTML: {\n        __html: this.props.value\n      },\n      onClick: e => {\n        if (e.target.title === \"点击放大\") {\n          this.setState({\n            url: e.target.src,\n            visible: true\n          });\n        }\n      },\n      ref: ref => this.inputText = ref,\n      style: {\n        display: isEdit ? \"block\" : \"none\",\n        height: isDisabled ? \"200px\" : \"auto\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    }), React.createElement(\"textarea\", {\n      style: {\n        display: isEdit ? \"none\" : \"block\"\n      },\n      ref: \"inputText2\",\n      id: \"editor-con\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197\n      },\n      __self: this\n    })), React.createElement(Modal, {\n      className: \"chat-model\",\n      style: {\n        width: \"70%\"\n      },\n      visible: visible,\n      footer: null,\n      onCancel: () => this.setState({\n        visible: false\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      src: this.state.url,\n      alt: \"img\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210\n      },\n      __self: this\n    })));\n  }\n\n}\nEditor.propTypes = {\n  className: PropTypes.string,\n  value: PropTypes.string,\n  editColor: PropTypes.string\n};","map":{"version":3,"sources":["/Users/guokai/Desktop/React-connect/src/Prism/Okadia/index22.jsx"],"names":["React","Component","Modal","message","PropTypes","ToolBar","Editor","constructor","props","moveToEnd","range","window","getSelection","selectAllChildren","refs","collapseToEnd","documentClick","e","state","isColor","isBackground","en","srcElement","target","name","className","replace","parentNode","setState","onPaste","cbd","clipboardData","items","onParseOrDrop","onDrop","preventDefault","dataTransfer","ua","navigator","userAgent","length","kind","types","match","Number","document","createElement","myArray","Object","keys","map","item","arr","some","u","type","error","forEach","blob","getAsFile","size","bind_parse","file","reader","FileReader","onload","newImg","result","onChange","inputText","innerHTML","readAsDataURL","textHtml","isEdit","html","value","myDisabled","emitChange","lastHtml","tableData","linkModel","visible","editValue","isFace","linkValue","isSent","componentDidMount","addEventListener","componentWillUnmount","removeEventListener","shouldComponentUpdate","nextProps","nextState","render","disabled","editColor","isDisabled","id","borderColor","__html","title","url","src","ref","display","height","width","propTypes","string"],"mappings":"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","sourcesContent":["/**\n * Created by zhanglei on 2017/5/23.\n */\nimport React, { Component } from \"react\";\nimport { Modal, message } from \"antd\";\nimport PropTypes from \"prop-types\";\n// import \"./edit.less\";\nimport ToolBar from \"./toolBar\";\nexport default class Editor extends Component {\n  static propTypes = {\n    className: PropTypes.string,\n    value: PropTypes.string,\n    editColor: PropTypes.string\n  };\n  constructor(props) {\n    super(props);\n    this.state = {\n      value: null,\n      tableData: [],\n      linkModel: false,\n      visible: false,\n      isColor: false,\n      editValue: \"\",\n      myDisabled: false,\n      isEdit: true,\n      isFace: false,\n      isBackground: false,\n      linkValue: null,\n      isSent: true\n    };\n  }\n  componentDidMount() {\n    document.addEventListener(\"click\", this.documentClick);\n  }\n  moveToEnd = () => {\n    const range = window.getSelection();\n    range.selectAllChildren(this.refs[\"inputText\"]);\n    range.collapseToEnd();\n  };\n  documentClick = e => {\n    const { isColor, isBackground } = this.state;\n    if (isColor || isBackground) {\n      let en = e.srcElement || e.target;\n      const name = \".color-content\";\n      while (en) {\n        if (en.className && en.className === name.replace(\".\", \"\")) {\n          return;\n        }\n        en = en.parentNode;\n      }\n      this.setState({ isColor: false, isBackground: false });\n    }\n  };\n  componentWillUnmount() {\n    document.removeEventListener(\"click\", this.documentClick);\n  }\n  onPaste = e => {\n    let cbd = e.clipboardData;\n    if (!(e.clipboardData && e.clipboardData.items)) {\n      return;\n    }\n    this.onParseOrDrop(cbd, e);\n  };\n  onDrop = e => {\n    e.preventDefault();\n    let cbd = e.dataTransfer;\n    if (!(e.dataTransfer && e.dataTransfer.items)) {\n      return;\n    }\n    this.onParseOrDrop(cbd, e);\n  };\n  onParseOrDrop = (cbd, e) => {\n    let ua = window.navigator.userAgent;\n    if (\n      cbd.items &&\n      cbd.items.length === 2 &&\n      cbd.items[0].kind === \"string\" &&\n      cbd.items[1].kind === \"file\" &&\n      cbd.types &&\n      cbd.types.length === 2 &&\n      cbd.types[0] === \"text/plain\" &&\n      cbd.types[1] === \"Files\" &&\n      ua.match(/Macintosh/i) &&\n      Number(ua.match(/Chrome\\/(\\d{2})/i)[1]) < 49\n    ) {\n      return;\n    }\n    if (cbd.items && cbd.items.length === 4) {\n      document.createElement(\"table\");\n      return false;\n    }\n    const myArray = Object.keys(cbd.items).map(item => {\n      return cbd.items[item];\n    });\n    const arr = myArray.some(u => {\n      if (\n        u.kind === \"file\" &&\n        u.type !== \"image/jpeg\" &&\n        u.type !== \"image/png\"\n      ) {\n        message.error(\"仅支持PNG或者JPG的图片格式上传\");\n        return !1;\n      }\n      return (\n        u.kind === \"file\" && (u.type === \"image/jpeg\" || u.type === \"image/png\")\n      );\n    });\n    if (!arr) return !1;\n    myArray.forEach(item => {\n      if (item.kind === \"string\") {\n        e.preventDefault();\n        return;\n      }\n      if (item.kind === \"file\") {\n        e.preventDefault();\n        const blob = item.getAsFile();\n        if (blob.size === 0) return;\n        this.bind_parse(blob);\n      }\n    });\n  };\n  bind_parse = file => {\n    const reader = new FileReader();\n    reader.onload = e => {\n      const newImg = `<img class=\"edit-img\" title='点击放大' src=\"${e.target.result}\"/>`;\n      const { onChange } = this.props;\n      if (onChange) {\n        onChange(this.inputText.innerHTML + newImg);\n      }\n    };\n    reader.readAsDataURL(file);\n  };\n  textHtml = e => {\n    e.preventDefault();\n    const { isEdit } = this.state;\n    let html = null;\n    if (isEdit) {\n      html = this.refs[\"inputText\"].innerHTML;\n      this.refs[\"inputText2\"].value = html;\n      this.setState({ isEdit: false, myDisabled: true });\n    } else {\n      html = this.refs[\"inputText2\"].value;\n      this.refs[\"inputText\"].innerHTML = html;\n      this.setState({ isEdit: true, myDisabled: false });\n    }\n  };\n  emitChange = e => {\n    const { onChange } = this.props;\n    const html = e.target.innerHTML;\n    if (onChange && html !== this.lastHtml) {\n      onChange(html);\n    }\n    this.lastHtml = html;\n  };\n  shouldComponentUpdate(nextProps, nextState) {\n    return (\n      nextProps.value !== this.props.value ||\n      this.state.editValue !== nextState.editValue ||\n      this.state.visible !== nextState.visible ||\n      this.state.myDisabled !== nextState.myDisabled\n    );\n  }\n  render() {\n    const { isEdit, visible, myDisabled } = this.state;\n    const { disabled, editColor } = this.props;\n    const isDisabled = !(\"disabled\" in this.props) || !disabled;\n    return (\n      <div className=\"editor-full\">\n        {isDisabled && (\n          <ToolBar\n            id={this.props.id}\n            myDisabled={myDisabled}\n            bind_parse={this.bind_parse}\n            textHtml={this.textHtml}\n          />\n        )}\n        <div className=\"inputText\" style={{ borderColor: editColor }}>\n          <div\n            className=\"input-content-edit\"\n            onPaste={this.onPaste}\n            onDrop={this.onDrop}\n            onInput={this.emitChange}\n            contentEditable={isDisabled}\n            onBlur={this.emitChange}\n            dangerouslySetInnerHTML={{ __html: this.props.value }}\n            onClick={e => {\n              if (e.target.title === \"点击放大\") {\n                this.setState({ url: e.target.src, visible: true });\n              }\n            }}\n            ref={ref => (this.inputText = ref)}\n            style={{\n              display: isEdit ? \"block\" : \"none\",\n              height: isDisabled ? \"200px\" : \"auto\"\n            }}\n          ></div>\n          <textarea\n            style={{ display: isEdit ? \"none\" : \"block\" }}\n            ref=\"inputText2\"\n            id=\"editor-con\"\n          />\n        </div>\n        <Modal\n          className=\"chat-model\"\n          style={{ width: \"70%\" }}\n          visible={visible}\n          footer={null}\n          onCancel={() => this.setState({ visible: false })}\n        >\n          <img src={this.state.url} alt=\"img\" />\n        </Modal>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}